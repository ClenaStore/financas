<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastros • Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --azul:#1F4E78;
  --azul-escuro:#12375A;
  --bg:#f4f6f9;
  --card:#ffffff;
  --texto:#222;
  --radius:12px;
  --shadow:0 6px 20px rgba(0,0,0,0.15);
}

body{
  margin:0;
  font-family: Arial, sans-serif;
  background:var(--bg);
  display:flex;
}

/* SIDEBAR */
#sidebar{
  width:270px;
  height:100vh;
  background:var(--azul);
  color:white;
  padding-top:30px;
  position:relative;
  transition:0.3s;
  overflow:hidden;
}

#sidebar.recolhido{
  width:70px;
}

#toggleSidebar{
  position:absolute;
  top:15px;
  right:-20px;
  width:40px;
  height:40px;
  border-radius:50%;
  background:white;
  border:none;
  color:var(--azul);
  font-size:20px;
  cursor:pointer;
  box-shadow:0 5px 15px rgba(0,0,0,0.3);
}

#sidebar h1{
  text-align:center;
  margin:0;
  margin-bottom:35px;
  font-size:24px;
  transition:0.3s;
}

#sidebar.recolhido h1{
  opacity:0;
}

.menu-btn{
  display:flex;
  align-items:center;
  gap:12px;
  padding:18px 22px;
  font-size:17px;
  text-decoration:none;
  color:white;
  border-bottom:1px solid rgba(255,255,255,0.10);
  transition:0.2s;
}

.menu-btn:hover{
  background:var(--azul-escuro);
  padding-left:32px;
}

.menu-icon{
  width:22px;
  height:22px;
  background:white;
  border-radius:4px;
}

#sidebar.recolhido .menu-text{
  opacity:0;
  width:0;
  overflow:hidden;
}

/* CONTEÚDO */
#conteudo{
  flex:1;
  padding:40px;
  overflow-y:auto;
}

h1{
  font-size:32px;
  color:var(--azul);
  margin-top:0;
}

.card{
  background:white;
  padding:25px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}

/* TABELA */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:25px;
}

th{
  background:var(--azul);
  color:white;
  padding:12px;
}

td{
  padding:12px;
  background:white;
  border-bottom:1px solid #ddd;
}

/* BOTÕES */
.btn{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.btn-green{ background:#4CAF50; color:white; }
.btn-blue{ background:var(--azul); color:white; }
.btn-red{ background:#C62828; color:white; }

/* MODAL */
#modal{
  position:fixed;
  inset:0;
  background:#0007;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal-box{
  background:white;
  padding:25px;
  width:95%;
  max-width:420px;
  border-radius:12px;
  box-shadow:var(--shadow);
}

.modal-box h2{
  margin-top:0;
  color:var(--azul);
}

input, select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

/* LOADING */
#overlay{
  position:fixed;
  inset:0;
  background:#0007;
  color:white;
  display:none;
  font-size:22px;
  align-items:center;
  justify-content:center;
  z-index:99999;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar">
  
  <button id="toggleSidebar" onclick="toggleSidebar()">☰</button>

  <h1>FINANCEIRO</h1>

  <a href="index.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Início</span>
  </a>

  <a href="cadastros.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Cadastros</span>
  </a>

  <a href="lancamentos.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Lançamentos</span>
  </a>

  <a href="fluxo.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Fluxo de Caixa</span>
  </a>

  <a href="dashboard.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Dashboard</span>
  </a>

  <a href="historico.html" class="menu-btn">
    <div class="menu-icon"></div>
    <span class="menu-text">Historico</span>
  </a>

</div>

<!-- CONTEÚDO -->
<div id="conteudo">

  <div class="card">
    <h1>Cadastros</h1>

    <button class="btn btn-green" onclick="abrirModal()">+ Novo Cadastro</button>

    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Categoria</th>
          <th>Subcategoria</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabelaCadastros"></tbody>
    </table>
  </div>

</div>

<!-- MODAL -->
<div id="modal">
  <div class="modal-box">
    <h2 id="modalTitulo">Novo Cadastro</h2>

    <input type="hidden" id="editId">

    <label>Tipo</label>
    <select id="tipo">
      <option value="Receita">Receita</option>
      <option value="Despesa">Despesa</option>
    </select>

    <label>Categoria</label>
    <input type="text" id="categoria">

    <label>Subcategoria</label>
    <input type="text" id="subcategoria">

    <br><br>
    <button class="btn btn-blue" onclick="salvarCadastro()">Salvar</button>
    <button class="btn btn-red" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<!-- LOADING -->
<div id="overlay">Carregando...</div>

<script>
/* ================= CONFIG ================= */
const API = "https://script.google.com/macros/s/AKfycbyInCpy_Ln1XQhcnbsfPHRimjx0frnOQDRgAyPtraKw_scr7uXP631SUyQZpIlUSi7IMA/exec";

/* ================= SIDEBAR ================= */
function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("recolhido");
}

/* ================= LOADING ================= */
function overlay(v){
  document.getElementById("overlay").style.display = v ? "flex" : "none";
}

/* ================= LISTAR ================= */
async function carregarCadastros(){
  overlay(true);

  const r = await fetch(API+"?action=listCadastros");
  const dados = await r.json();

  let html = "";

  dados.forEach(l => {
    html += `
      <tr>
        <td>${l[1]}</td>
        <td>${l[2]}</td>
        <td>${l[3]}</td>
        <td>
          <button class="btn btn-blue" onclick="editarCadastro('${l[0]}','${l[1]}','${l[2]}','${l[3]}')">Editar</button>
          <button class="btn btn-red" onclick="excluirCadastro('${l[0]}')">Excluir</button>
        </td>
      </tr>
    `;
  });

  document.getElementById("tabelaCadastros").innerHTML = html;
  overlay(false);
}

/* ================= MODAL ================= */
function abrirModal(){
  document.getElementById("modalTitulo").innerText = "Novo Cadastro";
  document.getElementById("editId").value = "";
  document.getElementById("tipo").value = "Receita";
  document.getElementById("categoria").value = "";
  document.getElementById("subcategoria").value = "";
  document.getElementById("modal").style.display = "flex";
}

function fecharModal(){
  document.getElementById("modal").style.display = "none";
}

/* ================= EDITAR ================= */
function editarCadastro(id, tipo, categoria, sub){
  document.getElementById("modalTitulo").innerText = "Editar Cadastro";
  document.getElementById("editId").value = id;
  document.getElementById("tipo").value = tipo;
  document.getElementById("categoria").value = categoria;
  document.getElementById("subcategoria").value = sub;
  document.getElementById("modal").style.display = "flex";
}

/* ================= SALVAR ================= */
async function salvarCadastro(){
  const id = document.getElementById("editId").value;
  const tipo = document.getElementById("tipo").value;
  const categoria = document.getElementById("categoria").value;
  const sub = document.getElementById("subcategoria").value;

  overlay(true);

  if(id){
    await fetch(API+`?action=editCadastro&id=${id}&tipo=${tipo}&categoria=${categoria}&subcategoria=${sub}`);
  } else {
    await fetch(API+`?action=createCadastro&tipo=${tipo}&categoria=${categoria}&subcategoria=${sub}`);
  }

  fecharModal();
  carregarCadastros();
}

/* ================= EXCLUIR ================= */
async function excluirCadastro(id){
  if(!confirm("Deseja excluir este cadastro?")) return;
  overlay(true);
  await fetch(API+`?action=deleteCadastro&id=${id}`);
  carregarCadastros();
}

/* ================= INICIO ================= */
carregarCadastros();

</script>

</body>
</html>

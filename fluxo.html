<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fluxo de Caixa</title>

<style>
:root{
  --azul:#1F4E78;
  --azul-escuro:#12375A;
  --verde:#2ECC71;
  --vermelho:#E74C3C;
  --bg:#f4f6f9;
  --shadow:0 4px 12px rgba(0,0,0,0.15);
  --radius:12px;
}

/* geral */
body{
  margin:0;
  padding:25px;
  font-family: Arial, sans-serif;
  background:var(--bg);
}

h1{
  font-size:32px;
  color:var(--azul);
  margin-bottom:20px;
}

/* tabela */
table{
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:var(--radius);
  overflow:hidden;
  box-shadow:var(--shadow);
}

thead{
  background:var(--azul);
  color:white;
}

th, td{
  padding:14px;
  text-align:left;
  font-size:16px;
}

tbody tr:nth-child(even){
  background:#eef4ff;
}

.valorPositivo{
  color:var(--verde);
  font-weight:bold;
}
.valorNegativo{
  color:var(--vermelho);
  font-weight:bold;
}

/* LOADING — mesmo estilo do dashboard */
#loading{
  position:fixed;
  bottom:20px;
  left:20px;
  background:#1F4E78;
  padding:12px 22px;
  border-radius:14px;
  color:white;
  font-size:16px;
  box-shadow:0 8px 28px rgba(0,0,0,0.2);
  display:none;
  z-index:999;
  animation:pulse 1.2s infinite;
}

@keyframes pulse{
  0%{ opacity:.5; transform:scale(.95); }
  50%{ opacity:1; transform:scale(1); }
  100%{ opacity:.5; transform:scale(.95); }
}
</style>
</head>

<body>

<div id="loading">Carregando fluxo...</div>

<h1>Fluxo de Caixa</h1>

<table>
  <thead>
    <tr>
      <th>Mês</th>
      <th>Receitas</th>
      <th>Despesas</th>
      <th>Saldo Mensal</th>
      <th>Saldo Acumulado</th>
    </tr>
  </thead>
  <tbody id="tabelaFluxo"></tbody>
</table>

<script>
const API = "https://script.google.com/macros/s/AKfycbyInCpy_Ln1XQhcnbsfPHRimjx0frnOQDRgAyPtraKw_scr7uXP631SUyQZpIlUSi7IMA/exec";

/* =======================
     LOADING
======================== */
function load(v){
  document.getElementById("loading").style.display = v ? "flex" : "none";
}

/* formato */
function fmt(v){
  return Number(v).toLocaleString("pt-BR",{ style:"currency", currency:"BRL" });
}

/* =======================
     CARREGAR FLUXO
======================== */
async function carregarFluxo(){
  load(true); // ativa animação

  try{
    let r = await fetch(API+"?action=fluxo");
    let dados = await r.json();

    let html = "";

    dados.slice(1).forEach(l => {
      let mes = l[0];
      let r = Number(l[1]);
      let d = Number(l[2]);
      let sm = Number(l[3]);
      let ac = Number(l[4]);

      html += `
        <tr>
          <td>${mes}</td>
          <td class="valorPositivo">${fmt(r)}</td>
          <td class="valorNegativo">${fmt(d)}</td>
          <td class="${sm>=0?'valorPositivo':'valorNegativo'}">${fmt(sm)}</td>
          <td class="${ac>=0?'valorPositivo':'valorNegativo'}">${fmt(ac)}</td>
        </tr>`;
    });

    document.getElementById("tabelaFluxo").innerHTML = html;

  }catch(e){
    alert("Erro ao carregar fluxo: " + e);
  }

  setTimeout(()=> load(false), 400); // remove animação suavemente
}

/* iniciar */
carregarFluxo();
</script>

</body>
</html>
